<!DOCTYPE html>
<meta charset="utf-8">
<html>
<head>
	<title>Translate Between Charts</title>
	<link rel="stylesheet" type="text/css" href="bootstrap.min.css">
	<link rel="stylesheet" href="csck.css">
	<script src="d3.v3.min.js"></script>
	<script type="text/javascript" src="csck.js"></script>
	<script type="text/javascript" src="queue.min.js"></script>
	<script type="text/javascript" src="common.js"></script>
	<link rel="stylesheet" href="//code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css">
	<script src="//code.jquery.com/jquery-1.11.0.js"></script>
	<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>
</head>
<body>
	<div id="studycontent">
		<div id="charts">
			<div id="leftChart" class="chart" style="clear:left;"></div>
			<div class="spacer"><img src="arrow.png" width="50" height="50"></div>
			<div id="rightChart" class="chart"></div>
		</div>

		<div class="container">
			<div class="row" style="margin-top:30px;">
				<div class="row">
					<div class="col-sm-offset-10 col-sm-2">
						<button id="submit" role="button" class="btn btn-primary btn-lg btn-block study" onclick="nextStep();">
							<span id="submitText">Submit</span>
							<div id="progressOutline"><div id="progressBar"></div></div>
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<div id="initial-instructions">
		<div class="row">
			<div class="col-sm-10">
				<h2>Study on Connected Scatterplots and Dual-Axes Line Charts</h2>
				<p>In this study, you will be asked to translate data points from one type of chart into another.</p>
				<img src="img/cs-tutorial5.png" width="1069" height="506">
				<p>Both charts show data over time. Dual-axis line charts (left) have a time axis along the bottom, and two vertical value axes. The points in the chart, as well as the lines between them, depict the data. The axes to the left and right of the chart are color-coded to match the colors of the lines they correspond to.</p>
				<p>Connected scatterplots (right) show the data in a two-dimensional space, where one value axis is horizontal, the other one vertical. The points represent points in time, just like in dual-axes line charts. In addition to the lines, the connected scatterplots shows arrows to indicate direction. The colors on the axis are the same as in the dual-axes line chart, and both represent the same data.</p>
				<p>You will now see a brief tutorial explaining the two chart types. Please pay close attention, since you likely haven't seen one of them before.</p>
				<p>The study begins right after the tutorial and consists of 28 steps in four phases. When you're done with each step, click the <i>Submit</i> button. You will then see how you did and be able to click the <i>Next</i> button to go to the next step. That button will also indicate your progress within the study.</p>
				<p>At the very end, you will be given a code to paste into Mechanical Turk to complete the HIT.</p>

				<button role="button" class="btn btn-primary btn-lg" onclick="tutorialStep(1);" style="float:right;">Start Tutorial</button>
			</div>
		</div>
	</div>

	<!-- Tutorial -->

	<div id="tutorial1" class="tutorial">
		<div class="row">
			<div class="col-sm-10">
				<h2>Study on Connected Scatterplots and Dual-Axes Line Charts</h2>
				<img src="img/cs-tutorial1.png" width="1069" height="506">
				<p>You will see dual-axes line charts and connected scatterplots. In this example, we will translate from the dual-axes line chart on the left to the connected scatterplot on the right.</p>
				<button role="button" class="btn btn-primary btn-lg" onclick="tutorialStep(2);" style="float:right;">Next
				</button>
			</div>
		</div>
	</div>

	<div id="tutorial2" class="tutorial">
		<div class="row">
			<div class="col-sm-10">
				<h2>Study on Connected Scatterplots and Dual-Axes Line Charts</h2>
				<img src="img/cs-tutorial2.png" width="1069" height="506">
				<p>Both charts show two series of data values over time. Point A is shown as two different points on the left, while it is only one point on the right.</p>
				<p>Axes with the same color correspond to each other between the charts: blue is the left axis in the dual-axes line chart and the vertical axis on the connected scatterplot on the right; green is the right axis in the dual-axes line chart and the horizontal axis on the connected scatterplot on the right.</p>
				<button role="button" class="btn btn-primary btn-lg" onclick="tutorialStep(3);" style="float:right;">Next
				</button>
			</div>
		</div>
	</div>

	<div id="tutorial3" class="tutorial">
		<div class="row">
			<div class="col-sm-10">
				<h2>Study on Connected Scatterplots and Dual-Axes Line Charts</h2>
				<img src="img/cs-tutorial3.png" width="1069" height="506">
				<p>Each point represents two data values. We draw lines between consecutive points in both charts.</p>
				<p>In the connected scatterplot on the right, the order of points is important, which is why there are arrows along some of the lines. In the dual-axes line chart on the left, time goes left to right, so we don't need arrows.</p>
				<button role="button" class="btn btn-primary btn-lg" onclick="tutorialStep(4);" style="float:right;">Next
				</button>
			</div>
		</div>
	</div>

	<div id="tutorial4" class="tutorial">
		<div class="row">
			<div class="col-sm-10">
				<h2>Study on Connected Scatterplots and Dual-Axes Line Charts</h2>
				<img src="img/cs-tutorial4.png" width="1069" height="506">
				<p>Depending on the values, the direction of the lines in the connected scatterplot changes. The length of the lines between points can also vary dramatically, depending on the difference in the values represented.</p>
				<button role="button" class="btn btn-primary btn-lg" onclick="tutorialStep(5);" style="float:right;">Next
				</button>
			</div>
		</div>
	</div>

	<div id="tutorial5" class="tutorial">
		<div class="row">
			<div class="col-sm-10">
				<h2>Study on Connected Scatterplots and Dual-Axes Line Charts</h2>
				<img src="img/cs-tutorial5.png" width="1069" height="506">
				<p>The completed charts. In the study, you will translate from and to dual-axes line charts and connected scatterplots.</p>
				<p>Please be as precise as possible in transferring or copying the values from one chart to the other.</p>
				<button role="button" class="btn btn-primary btn-lg" onclick="startStudy();" style="float:right;">Next
				</button>
			</div>
		</div>
	</div>

	<!-- Phase Instructions -->

	<div id="instructions-cs2cs" class="instructions">
		<div class="row">
			<div class="col-sm-10">
				<h2>Copy Connected Scatterplot to Connected Scatterplot</h2>
				<p>In this part of the study, you will see two connected scatterplots side by side. Copy the data values from the chart on the left to the one on the right.</p>
				<img src="img/cs2cs.png" width="1210" height="540">
				<p></p>
				<button role="button" class="btn btn-primary btn-lg" onclick="nextStep();" style="float:right;">Start
				</button>
			</div>
		</div>
	</div>

	<div id="instructions-cs2dalc" class="instructions">
		<div class="row">
			<div class="col-sm-10">
				<h2>Translate Connected Scatterplot to Dual-Axes Line Chart</h2>
				<p>In this part of the study, you will see a connected scatterplot on the left and a dual-axes line chart on the right. Translate the data values from the left chart to the one on the right.</p>
				<img src="img/cs2dalc.png" width="1210" height="540">
				<p></p>
				<button role="button" class="btn btn-primary btn-lg" onclick="nextStep();" style="float:right;">Start
				</button>
			</div>
		</div>
	</div>

	<div id="instructions-dalc2cs" class="instructions">
		<div class="row">
			<div class="col-sm-10">
				<h2>Translate Dual-Axes Line Chart to Connected Scatterplot</h2>
				<p>In this part of the study, you will see a dual-axes line chart on the left and a connected scatterplot on the right. Translate the data values from the left chart to the one on the right.</p>
				<img src="img/dalc2cs.png" width="1210" height="540">
				<p></p>
				<button role="button" class="btn btn-primary btn-lg" onclick="nextStep();" style="float:right;">Start
				</button>
			</div>
		</div>
	</div>

	<div id="instructions-dalc2dalc" class="instructions">
		<div class="row">
			<div class="col-sm-10">
				<h2>Copy Dual-Axes Line Chart to Dual-Axes Line Chart</h2>
				<p>In this part of the study, you will see a connected scatterplot on the left and a dual-axes line chart on the right. Copy the data values from the chart on the left to the one on the right.</p>
				<img src="img/dalc2dalc.png" width="1210" height="540">
				<p></p>
				<button role="button" class="btn btn-primary btn-lg" onclick="nextStep();" style="float:right;">Start
				</button>
			</div>
		</div>
	</div>

	<div id="thankyou" class="instructions">
		<div class="row">
			<div class="col-sm-offset-1 col-sm-6">
				<h2>Thank you for your participation!</h2>
				<p>Your responses have been recorded. Thanks for taking part in this study!</p>
				<p id="mturk" style="display:none;">Here is the code to provide to finish this HIT on Mechnical Turk: <b><span id="mturk-code"></span></b></p>
			</div>
		</div>
	</div>

<script type="text/javascript">

	var studyID = 'translate';
	var resultID = makeResultID();

	var step = -1;

	var next = false;

	var startTime = new Date().getTime();

	var modes = ['dalc2cs', 'cs2dalc', 'cs2cs', 'dalc2dalc'];

	var currentMode = -1;

	var stepsPerMode;

	var phaseChange = false;

	function tutorialStep(step) {
		if (step === 1) {
			d3.select('#initial-instructions').style('display', 'none');
		} else {
			d3.select('#tutorial'+(step-1)).style('display', 'none');
		}
		d3.select('#tutorial'+step).style('display', 'block');
	}

	function nextStep() {
		if (step === stepsPerMode*(currentMode+1) && !phaseChange) {
			submitResults();
			nextPhase();
			d3.select('#submitText').text('Submit');
			d3.select('#submit').classed('btn-primary', true).classed('btn-success', false);
			startTime = new Date().getTime();
		} else {
			d3.select('#instructions-'+modes[currentMode]).style('display', 'none');
			d3.select('#studycontent').style('display', 'block');

			if (next) {
				toggleCheatMode(false);
				next = false;
				loadData(step);
				step += 1;
				d3.select('#submitText').text('Submit');
				d3.select('#submit').classed('btn-primary', true).classed('btn-success', false);
				startTime = new Date().getTime();
			} else {
				submitResults();
				d3.select('#submitText').text('Next');
				d3.select('#submit').classed('btn-primary', false).classed('btn-success', true);
				$('#progressBar').width('' + step / datasets.length * 100 + '%');
				toggleCheatMode(true);
				next = true;
			}
		}
		phaseChange = false;
	}

	function submitResults() {
		var globalDelta = 0;
		rightChart.points.forEach(function(d, i) {
			d.delta1 = d.value1-leftChart.points[i].value1;
			d.delta2 = d.value2-leftChart.points[i].value2;
			d.delta = Math.sqrt(d.delta1*d.delta1+d.delta2*d.delta2);
			globalDelta += d.delta;
		});
		globalDelta /= rightChart.points.length;
		submitResponse(studyID, resultID+'-'+datasets[step-1].name, {
			mode: modes[currentMode],
			step: step,
			stepInMode: step % stepsPerMode,
			dataset: datasets[step-1].name,
			time: (new Date()).getTime()-startTime,
			clockwise: clockwise,
			platform: navigator.platform,
			globalDelta: globalDelta,
			points: rightChart.points
		});
	}

	function nextPhase() {
		d3.select('#studycontent').style('display', 'none');
		if (step < datasets.length) {
			currentMode += 1;
			step = Math.max(step, 0);
			next = true;
			d3.select('#instructions-'+modes[currentMode]).style('display', 'block');
			initialSetup(modes[currentMode][0] === 'd', modes[currentMode][modes[currentMode].length-1] === 'c');
			phaseChange = true;
		} else {
			d3.select('#thankyou').style('display', 'block');
		}
	}

	function startStudy() {
		d3.select('#tutorial5').style('display', 'none');
		nextPhase();
	}

	if (window.location.hash === '#test') {
		studyID += '-test';
	} else if (window.location.hash === '#mturk') {
		studyID += '-mturk';
		d3.select('#mturk').style('display', 'block');
		d3.select('#mturk-code').text(resultID);
	}


	loadDataSets(true, function() {
		GENERATEDATASETS = false;
		ARROW_FRACTION = .5;

		study = true;

		disconnected = true;
		randomizeRightChart = true;
		showArrows = true;
		smoothLines = false;
		commonScales = true;
		cheatMode = false;

		d3.shuffle(datasets);
		d3.shuffle(modes);

		stepsPerMode = datasets.length/modes.length;
	}, 'translate');

</script>
</body>
</html>
